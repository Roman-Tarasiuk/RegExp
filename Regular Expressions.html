<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Regular Expressions</title>
    <link rel="shortcut icon" href="icon_RegExp.png">
    <style>
        p {
            margin: 0;
        }

        .regularExpressionsPluginP {
                margin: 0;
                font-weight: bold;
        }
    </style>
</head>

<body>
    <p class='regularExpressionsPluginP'>Input:</p>
    <textarea id='input' style='width: 75%; height: 100px;'></textarea>

    <p class='regularExpressionsPluginP'>Regular expression:</p>
    <textarea id='regexp' style='width: 75%; height: 22px;'><td><b>(.*?)<\/b>( .*?)<br>(?:<a href="mailto:(.*?@.*?)">)?.*\n\s*<td>(.*?)<\/td></textarea>

    <p class='regularExpressionsPluginP'>Flags:</p>
    <input type=text id='flags' style='width: 75%; height: 22px;' value='g'></textarea>

    <p class='regularExpressionsPluginP'>Show results like this (use match[index]):</p>
    <textarea id='resultsPattern' style='width: 75%; height: 22px;'>match[1] + match[2] + '\t' + match[3] + '\t' + match[4] + '\n***'</textarea>

    <div id='regularExpressionsPluginSets'>
        <button onclick='process()' style='font-weight: bold;'>Process</button>
        <button onclick='saveSet()' style='color: red;'>Save set</button>
    </div>

    <p class='regularExpressionsPluginP'>Matches:</p>
    <textarea id='results' style='width: 75%; height: 100px;'></textarea>

    <script>
        // To embed this page into other page (e.g. over Greasemonkey in Mozilla Firefox)
        // 1. Define process() as window.process = function () {...};
        //    define saveSet() in the same way.
        //
        // 2. For correct using double quotes, make next replacements in body (html + 2 comments below or desired) content:
        // " -> \"         (normal)
        // \ -> \\         (normal)
        // \\" -> \"       (normal)
        // \r\n -> \\\r\n  (extended)
        //
        // 3. Append result into code (divRegularExpressions.innerHTML):
        // window.getSource = function () {
        //   document.getElementById('input').value = document.body.innerHTML;
        // }
        //
        // var div = document.createElement('div');
        // div.setAttribute('id', 'regularExpressionsPlugin');
        // div.setAttribute('style', 'border: 2px solid green; padding: 5px; margin: 2px;');
        //
        // var divBtn = document.createElement('div');
        // divBtn.innerHTML = '<button onclick="getSource()">Get page source</button>';
        //
        // div.appendChild(divBtn);
        //
        // var divRegularExpressions = document.createElement('div');
        // divRegularExpressions.innerHTML = "*** *** *** PUT MODIFIED HTML HERE INTO DOUBLE QUOTES *** *** ***";
        //
        // div.appendChild(divRegularExpressions);
        //
        // document.body.appendChild(div);
        //
        // var style = document.createElement('style');
        // style.innerHTML = '\
        //     .regularExpressionsPluginP {\
        //         margin: 0;\
        //         font-weight: bold;\
        //     }';
        //
        // document.head.appendChild(style);
        //
        // 4. Move result regular expression and results pattern into html for auto loading.
        //

        // branch RE: <a href="http:\/\/www.kv.aval\/ua\/phone_list.html\?rootId=\d*" (style="cursor:pointer;">)(.*?)</a>(?:.*?\1(.*?)</a>(?:.*?\1(.*?)</a>(?:.*?\1(.*?)</a>(?:.*?\1(.*?)</a>)?)?)?)?
        // results  : match[2] + ' -> ' + match[3] + ' -> ' + match[4] + ' -> ' + match[5] + ' -> ' + match[6]

        // phones RE: <td><b>(.*?)<\/b>( .*?)<br>(?:<a href="mailto:(.*?@.*?)">)?.*\n\s*<td>(.*?)<\/td>
        // results  : match[1] + match[2] + '\t' + match[3] + '\t' + match[4]

        (function getSavedSets() {
            console.log(' ** Trying to load saved cookies...');
        })();

        function process() {
            var rePattern = document.getElementById('regexp').value;
            var reFlags = document.getElementById('flags').value;
            var resultsPattern = document.getElementById('resultsPattern').value;

            var RE = new RegExp(rePattern, reFlags);

            var input = document.getElementById('input').value;

            var resultsCtrl = document.getElementById('results');

            resultsCtrl.value = '';

            var count = 0;
            var resultsStr = '';

            var match;
            while ((match = RE.exec(input)) != null) {
                resultsStr += eval(resultsPattern) + '\n';
                count++;
            }

            if (count == 0) {
                resultsCtrl.value = 'No matches...';
            }
            else {
                resultsCtrl.value = resultsStr;
            }
        }
        
        function saveSet() {
            if (window.regularExpressionsPluginSetsArray == undefined) {
                window.regularExpressionsPluginSetsArray = [];
            }
            
            var id = 'regularExpressionsPluginSets' + window.regularExpressionsPluginSetsArray.length;
            
            var radio = document.createElement('input');
            radio.setAttribute('type', 'radio');
            radio.setAttribute('id', id);
            radio.setAttribute('name', 'regularExpressionsPluginSets');
            radio.addEventListener('click', window.selectSet = function (event) {
                var index = parseInt(event.target.id.substring('regularExpressionsPluginSets'.length));
                console.log(index + ' set selected');
                
                document.getElementById('regexp').value = window.regularExpressionsPluginSetsArray[index].re;
                document.getElementById('resultsPattern').value = window.regularExpressionsPluginSetsArray[index].resPatt;
            });
            
            var label = document.createElement('label');
            label.setAttribute('for', 'regularExpressionsPluginSets' + window.regularExpressionsPluginSetsArray.length);
            label.innerText = window.regularExpressionsPluginSetsArray.length;
            
            document.getElementById('regularExpressionsPluginSets').appendChild(radio);
            document.getElementById('regularExpressionsPluginSets').appendChild(label);
            
            var re = document.getElementById('regexp').value;
            var resPatt = document.getElementById('resultsPattern').value;
            window.regularExpressionsPluginSetsArray.push({re: re, resPatt: resPatt});
        }
    </script>
</body>
</html>