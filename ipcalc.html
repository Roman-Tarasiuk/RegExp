<!DOCTYPE html>
<html>
<head>
    <title>IP Calculator</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">

    <style>
        .ip {
            font-family: monospace;
            width: 156px;
        }

        .ip-calc-btn-hidden {
            visibility: hidden;
        }

        .bit {
            font-family: monospace;
            width: 20px;
            margin-top: 2px;
        }

        .wrap {
        }
    </style>
    
    <script>
    function q() {
        var t = document.getElementById('test');
        var d = document.getElementById('theDate');
        t.innerText = d.value;
    }

    ipcalc = {
        IPtoDec: function(bytes) {
            return bytes.join('.');
        },

        IPtoHex: function(bytes) {
            var resultStrHex = '';
            for (var i = 0; i < 4; i++) {
                resultStrHex +=
                    (bytes[i] < 16 ? '0' : '')
                    + bytes[i].toString(16)
                    + (i < 3 ? '.' : '');
            }

            return resultStrHex;
        },

        IPtoStr: function(bytes) {
            var result = '';
            for (var i = 0; i < bytes.length; i++) {
                var byteTmp = bytes[i].toString(2);
                byteTmp = '00000000'.substr(0, 8 - byteTmp.length) + byteTmp;
                result += byteTmp + (i < bytes.length - 1 ? '.' : '');
            }
            
            return result;
        },
        
        bitSwitch: function() {
            var bytes = [];

            for (var i = 1; i <= 4; i++) {
                var tmp = 0;
                for (var j = 7; j >= 0; j--) {
                    var bitEl = document.getElementById('chIP' + i + j);
                    if (bitEl.value == '1') {
                        tmp += Math.pow(2, j);
                    }
                }
                bytes.push(tmp);
            }
            
            document.getElementById('theIP').value = this.IPtoDec(bytes);
            document.getElementById('theIPHex').value = this.IPtoHex(bytes);
            document.getElementById('bits').innerText = this.IPtoStr(bytes);
        },

        setBits: function(bytes) {
            for (var i = 0; i < bytes.length; i++) {
                var byteTmp = bytes[i].toString(2);
                byteTmp = '00000000'.substr(0, 8 - byteTmp.length) + byteTmp;

                for (var j = 7; j >=0; j--) {
                    var bitEl = document.getElementById('chIP' + (i + 1) + (7 - j));
                    bitEl.value = byteTmp[j] == '1' ? '1' : '0';
                }
            }
        },
        
        clearAll: function() {
            for (var i = 1; i <= 4; i++) {
                for (var j = 7; j >= 0; j--) {
                    var bitEl = document.getElementById('chIP' + i + j);
                    bitEl.value = '0';
                }
            }
            
            document.getElementById('theIP').value = '0.0.0.0';
            document.getElementById('theIPHex').value = '00.00.00.00';
            document.getElementById('bits').innerText
                = '00000000.00000000.00000000.00000000';
        },

        focusInput: function(id) {
            setTimeout(() => {
                document.getElementById(id).classList.remove('ip-calc-btn-hidden');
            }, 200);
        },

        blurInput: function(id) {
            setTimeout(() => {
                document.getElementById(id).classList.add('ip-calc-btn-hidden');
            }, 200);
        },

        getUserIP: function(input, radix) {
            var ipStr = document.getElementById(input).value;
            var ipBytesStr = ipStr.split('.');
            var ipBytes = [];
            for (var i = 0; i < ipBytesStr.length; i++) {
                ipBytes.push(Number.parseInt(ipBytesStr[i], radix));
            }

            return ipBytes;
        },

        calculateDec: function() {
            var ipBytes = this.getUserIP('theIP', 10);
            this.setBits(ipBytes);
            document.getElementById('theIPHex').value = this.IPtoHex(ipBytes);
            document.getElementById('bits').innerText = this.IPtoStr(ipBytes);
        },

        calculateHex: function() {
            var ipBytes = this.getUserIP('theIPHex', 16);
            this.setBits(ipBytes);
            document.getElementById('theIP').value = this.IPtoDec(ipBytes);
            document.getElementById('bits').innerText = this.IPtoStr(ipBytes);
        },

        wrapBytes: function() {
            var brs = document.querySelectorAll('.wrap');
            var wrap = document.getElementById('wrapBytes').checked;
            for (var i = 0; i < brs.length; i++) {
                if (!wrap) {
                    brs[i].style.display = 'none';
                }
                else {
                    brs[i].style.display = '';
                }
            }
        }
    }
    
    window.onload = function() {
        var t = document.getElementById('theCalc');
        
        for (var i = 1; i <= 4; i++) {
        	for (var j = 7; j >= 0; j--) {
        	    var ch = document.createElement('input');
                ch.setAttribute('type', 'text');
                ch.setAttribute('id', 'chIP' + i + j);
                ch.setAttribute('readonly', 'readonly');
                ch.setAttribute('class', 'bit');
                ch.addEventListener('click', function (e) {
                    if (this.value == '0') {
                        this.value = '1';
                    }
                    else {
                        this.value = '0';
                    }

                    ipcalc.bitSwitch();
                });
                ch.value = '0';
                t.appendChild(ch);
        	}
            if (i != 4) {
            	var br = document.createElement('br');
                br.setAttribute('class', 'wrap');
                var dot = document.createElement('span');
                dot.innerText = ' .';
                
                t.appendChild(dot);
                t.appendChild(br);
        	}
        }

        ipcalc.wrapBytes();
    }
    </script>
</head>

<body>
	<div class="container mt-5">
        <h1>IP Calculator</h1>

        <!--p id="test">Hello World!</p>
        <input type="date" id="theDate">
        <br>
        <button onclick="q()">Q</button-->
        
        <div>
            <div id="theCalc">
            </div>
            <label style="margin-top: 5px; margin-bottom: 5px; color: grey;">
                <input type="checkbox" id="wrapBytes" onchange="ipcalc.wrapBytes()"> Wrap
            </label>
            <div>
                <code id="bits">00000000.00000000.00000000.00000000</code>
            </div>
            <div>
                <input type="text" id="theIP" class="ip" value="0.0.0.0"
                    onfocus="ipcalc.focusInput('calcDec')" onblur="ipcalc.blurInput('calcDec')"></input>
                <button type="button" id="calcDec" class="btn btn-secondary ip-calc-btn-hidden"
                    onclick="ipcalc.calculateDec()">
                    <i class="bi bi-calculator"></i>
                </button>
            </div>
            <div>
                <input type="text" id="theIPHex" class="ip" value="00.00.00.00"
                    onfocus="ipcalc.focusInput('calcHex')" onblur="ipcalc.blurInput('calcHex')"></input>
                    <button type="button" id="calcHex" class="btn btn-secondary ip-calc-btn-hidden"
                    onclick="ipcalc.calculateHex()">
                    <i class="bi bi-calculator"></i>
                </button>
            </div>
            <button onclick="ipcalc.clearAll()">Clear</button>
        </div>
        
        <br>

        <h3>Notes</h3>
        <textarea style="width: 100%; white-space: nowrap; overflow: auto; resize: both;" rows="4"></textarea>
        
        <div>
        	<h3>Links:</h3>
            <a href="https://en.wikipedia.org/wiki/IP_address">IP address (Wikipedia)</a>
            <br>
            <a href="https://en.wikipedia.org/wiki/OSI_model">OSI Model (Wikipedia)</a>
            <br>
            <a href="https://en.wikipedia.org/wiki/Internet_protocol_suite">Internet protocol suite (Wikipedia)</a>
            <br>
            <a href="https://www.imperva.com/learn/application-security/osi-model/">OSI Model (Imperva)</a>
            <br>
        </div>
    </div> 
</body>
</html>