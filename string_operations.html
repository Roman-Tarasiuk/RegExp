<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>String operations</title>

    <link rel="shortcut icon" href="img/icon_StringsOriginal.png">
    <link rel="stylesheet" type="text/css" href="css/string_operations.css">
</head>

<body>
    <div>
        <div class="container">
            <div class="input-holder clear-btn" onclick="clearInput(this)">
                <input type="text" id="str1" oninput="reset()" onchange="reset()" />
            </div>
        </div>
        <div class="container">
            <div class="input-holder clear-btn" onclick="clearInput(this)">
                <input type="text" id="str2" oninput="reset()" onchange="reset()" />
            </div>
        </div>
        <div class="container">
            <div class="input-holder cmpr-btn" onclick="compare()">
                <input type="text" id="result"/>
            </div>
        </div>

        <label>
            <input type="checkbox" id="ignoreCase"> Ignore case
        </label>

        <p id="count">Differences: ...</p>

        <div class="hover" style="margin-top: 2px; color: #aaa;">
            <span>Texts' width:</span>
            <input type=number
                    id="width"
                    onkeyup="return onInputKeyUp(event)"
                    onchange="setLength(document.getElementById('width'))"
                    value="700"
                    style="width: 50px;"/>
            <span>px</span>
        </div>
    </div>

    <div class="hover">
        <div>
            <p style="margin-bottom: 2px;">String manipulations:</p>
            <textarea id="txt" onclick="document.getElementById('length').innerText='';"></textarea>
            <br>
            <button onclick="replaceAll()">Replace all</button>
            <button onclick="removeSpaces()">Remove spaces</button>
            <button onclick="removeLineBreaks()">Remove line breaks</button>
            <button onclick="removeAllSpaces()"><b>Remove all space characters</b></button>
            <span>
                <button onclick="getLength()">Length</button>
                <span id="length"></span>
            </span>
        </div>
        <div style="margin-top: 20px; background-color: #d9d9d9; width: 800px; padding: 5px;">
            <label style="display: block; padding-bottom: 7px;">Replace all presets:</label>
            <label for="oldValue">Old value:</label>
            <input type="text" id="oldValue" name="oldValue" style="width: 220px; vertical-align: bottom;"></input>
            <label for="newValue">New value:</label>
            <input type="text" id="newValue" name="newValue" style="width: 220px; vertical-align: bottom;"></input>
            <br>
            <button onclick="addReplacement()">Add</button>
            <button onclick="removeReplacement()">Remove</button>
            <br>
            <select id="replacements" size="10" onchange="selectedItemChanged()" style="width: 750px;"></select>
        </div>
    </div>


    <script src="js/jquery.min.js"></script>

    <script>
        var searchValue = '';
        var newValue = '';
        var newValueLineBreak = ' ';
        var replacements = [];

        document.getElementById('str1').addEventListener('click', stopPropag, false);
        document.getElementById('str2').addEventListener('click', stopPropag, false);
        document.getElementById('result').addEventListener('click', stopPropag, false);

        function clearInput(el) {
            el.children[0].value = '';
            reset();
        }

        function stopPropag(event) {
            event.stopPropagation();
        }

        function reset() {
            document.getElementById('count').innerHTML = 'Differences: ...';
            document.getElementById('result').value = '';
        }

        function setWidth() {
            document.getElementById('width').value = parseInt(document.getElementById('result').style.width);
        }

        function onInputKeyUp(e) {
            var numberElem = document.getElementById('width');
            if(document.activeElement == numberElem) {
                if(e.keyCode == 38 || e.keyCode == 40) {
                    setLength(numberElem);
                }
            }
        }

        function setLength(numberElem) {
            document.getElementById('result').style.width = numberElem.value + 'px';
            document.getElementById('str1').style.width = numberElem.value + 'px';
            document.getElementById('str2').style.width = numberElem.value + 'px';
        }

        function compare() {
            var str1 = document.getElementById('str1');
            var str2 = document.getElementById('str2');
            var ignoreCase = document.getElementById('ignoreCase');

            var compareResult = null;

            if (str1.value.length >= str2.value.length) {
                compareResult = cmp(str1.value, str2.value, ignoreCase.checked);
            }
            else {
                compareResult = cmp(str2.value, str1.value, ignoreCase.checked);
            }

            document.getElementById('result').value = compareResult.compareStr;
            document.getElementById('count').innerHTML = 'Differences found: ' + compareResult.placesCount;

            function cmp(str1, str2, ignoreCase) { // str1.length >= str2.length
                if (ignoreCase) {
                    str1 = str1.toUpperCase();
                    str2 = str2.toUpperCase();
                }

                var resultStr = new Array(str1.length).fill(' ');
                var placesCount = 0;

                for (var i = 0; i < str1.length; i++) {
                    if (i >= str2.length || str2[i] != str1[i]) {
                        resultStr[i] = 'x';
                        if (i == 0 || resultStr[i - 1] == ' ') {
                            placesCount++;
                        }
                    }
                }

                return {
                    compareStr: resultStr.join(''),
                    placesCount: placesCount
                };
            }
        }

        function removeLineBreaks() {
            var txt = document.getElementById('txt');

            var re = /\n/g;

            var replaceTo = prompt('Enter new value:', newValueLineBreak);

            if (replaceTo == null) {
                return;
            }

            newValueLineBreak = replaceTo;
            replaceTo = replaceTo.replace(/\\n/g, '\n');
            replaceTo = replaceTo.replace(/\\t/g, '\t');

            txt.value = txt.value.replace(re, replaceTo);
            txt.select();
        }

        function removeSpaces() {
            var txt = document.getElementById('txt');

            var re = / /g;
            var replaceTo = '';

            txt.value = txt.value.replace(re, replaceTo);
            txt.select();
        }

        function removeAllSpaces() {
            var txt = document.getElementById('txt');

            var re = /\s/g;
            var replaceTo = '';

            txt.value = txt.value.replace(re, replaceTo);
            txt.select();
        }

        function replaceAll() {
            var txt = document.getElementById('txt');

            var oldVal = document.getElementById('oldValue');
            var newVal = document.getElementById('newValue');

            var searchFor = oldVal.value;
            if (searchFor == null || searchFor == '') {
                return;
            }

            var replaceTo = newVal.value;

            searchValue = searchFor;
            newValue = replaceTo;

            searchFor = searchFor.replace(/\\n/g, '\n');
            searchFor = searchFor.replace(/\\t/g, '\t');
            searchFor = searchFor.replace(/\./g, '\\.');

            replaceTo = replaceTo.replace(/\\n/g, '\n');
            replaceTo = replaceTo.replace(/\\t/g, '\t');

            var re = new RegExp(searchFor, 'g');

            txt.value = txt.value.replace(re, replaceTo);
            txt.select();
        }

        function addReplacement() {
            var oldVal = document.getElementById('oldValue');
            var newVal = document.getElementById('newValue');
            var select = document.getElementById('replacements');

            var option = document.createElement("option");
            option.text = '\'' + oldVal.value + '\' -> \'' + newVal.value + '\'';

            replacements.push({
                'old' : oldVal.value,
                'new' : newVal.value,
            })

            select.add(option);
        }

        function removeReplacement() {
            var select = document.getElementById('replacements');

            var i = select.selectedIndex;

            select.remove(i);
            replacements.splice(i, 1);
        }

        function selectedItemChanged() {
            var oldVal = document.getElementById('oldValue');
            var newVal = document.getElementById('newValue');
            var select = document.getElementById('replacements');

            var i = select.selectedIndex;

            oldVal.value = replacements[i]['old'];
            newVal.value = replacements[i]['new'];
        }

        function getLength() {
            var txt = document.getElementById('txt');
            var length = document.getElementById('length');

            length.innerText = txt.value.length;
        }

        $('body').keydown(function(event) {
            if (event.keyCode == 36) { // Home.
                $('body').scrollLeft(0);
            }
            else if (event.keyCode == 35) { // End.
                var width = $('#width').val();
                $('body').scrollLeft(width);
            }
        });
    </script>
</body>
</html>