<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>String operations</title>
    
    <link rel="shortcut icon" href="img/icon_StringsOriginal.png">
    <link rel="stylesheet" type="text/css" href="css/string_operations.css">
</head>

<body>
    <div>
        <div class="container">
            <div class="input-holder clear-btn" onclick="clearInput(this)">
                <input type="text" id="str1" oninput="reset()" onchange="reset()" />
            </div>
        </div>
        <div class="container">
            <div class="input-holder clear-btn" onclick="clearInput(this)">
                <input type="text" id="str2" oninput="reset()" onchange="reset()" />
            </div>
        </div>
        <div class="container">
            <div class="input-holder cmpr-btn" onclick="compare()">
                <input type="text" id="result"/>
            </div>
        </div>

        <p id="count">Differences: ...</p>

        <div class="hover" style="margin-top: 2px; color: #aaa;">
            <span>Texts' width:</span>
            <input type=number
                    id="width"
                    onkeyup="return onInputKeyUp(event)"
                    onchange="setLength(document.getElementById('width'))"
                    value="700"
                    style="width: 50px;"/>
            <span>px</span>
        </div>
    </div>

    <div class="hover">
        <p style="margin-bottom: 2px;">String manipulations:</p>
        <textarea id="txt" onclick="document.getElementById('length').innerText='';"></textarea>
        <br>
        <button onclick="removeLineBreaks()" title="Replace to space character">Remove line breaks</button>
        <button onclick="removeAllSpaces()">Remove all spaces</button>
        <span>
            <button onclick="getLength()">Length</button>
            <span id="length"></span>
        </span>
    </div>

    
    <script src="js/jquery.min.js"></script>
    
    <script>
        document.getElementById('str1').addEventListener('click', stopPropag, false);
        document.getElementById('str2').addEventListener('click', stopPropag, false);
        document.getElementById('result').addEventListener('click', stopPropag, false);

        function clearInput(el) {
            el.children[0].value = '';
            reset();
        }

        function stopPropag(event) {
            event.stopPropagation();
        }

        function reset() {
            document.getElementById('count').innerHTML = 'Differences: ...';
            document.getElementById('result').value = '';
        }

        function setWidth() {
            document.getElementById('width').value = parseInt(document.getElementById('result').style.width);
        }

        function onInputKeyUp(e) {
            var numberElem = document.getElementById('width');
            if(document.activeElement == numberElem) {
                if(e.keyCode == 38 || e.keyCode == 40) {
                    setLength(numberElem);
                }
            }
        }

        function setLength(numberElem) {
            document.getElementById('result').style.width = numberElem.value + 'px';
            document.getElementById('str1').style.width = numberElem.value + 'px';
            document.getElementById('str2').style.width = numberElem.value + 'px';
        }

        function compare() {
            var text1 = document.getElementById('str1');
            var text2 = document.getElementById('str2');
            var compareResult = null;

            if (text1.value.length >= text2.value.length) {
                compareResult = cmp(text1.value, text2.value);
            }
            else {
                compareResult = cmp(text2.value, text1.value);
            }

            document.getElementById('result').value = compareResult.compareStr;
            document.getElementById('count').innerHTML = 'Differences found: ' + compareResult.placesCount;

            function cmp(txt1, txt2) { // txt1.length >= txt2.length
                var resultStr = new Array(txt1.length).fill(' ');
                var placesCount = 0;

                for (var i = 0; i < txt1.length; i++) {
                    if (i >= txt2.length || txt2[i] != txt1[i]) {
                        resultStr[i] = 'x';
                        if (i == 0 || resultStr[i - 1] == ' ') {
                            placesCount++;
                        }
                    }
                }

                return {
                    compareStr: resultStr.join(''),
                    placesCount: placesCount
                };
            }
        }

        function removeLineBreaks() {
            var txt = document.getElementById('txt');

            var re = /\n/g;
            var replaceTo = ' ';

            txt.value = txt.value.replace(re, replaceTo);
            txt.select();
        }

        function removeAllSpaces() {
            var txt = document.getElementById('txt');

            var re = /\s/g;
            var replaceTo = '';

            txt.value = txt.value.replace(re, replaceTo);
            txt.select();
        }
        
        function removeAllSpaces() {
            var txt = document.getElementById('txt');
            
            var re = /\s/g;
            var replaceTo = '';
            
            txt.value = txt.value.replace(re, replaceTo);
            txt.select();
        }
        
        function getLength() {
            var txt = document.getElementById('txt');
            var length = document.getElementById('length');
            
            length.innerText = txt.value.length;
        }
        
        $('body').keydown(function(event) {
            if (event.keyCode == 36) { // Home.
                $('body').scrollLeft(0);
            }
            else if (event.keyCode == 35) { // End.
                var width = $('#width').val();
                $('body').scrollLeft(width);
            }
        });
    </script>
</body>
</html>